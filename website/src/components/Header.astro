---
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;
const base = import.meta.env.BASE_URL;
---
<header class="fixed top-0 left-0 right-0 z-50 bg-background/90 backdrop-blur-md border-b border-border shadow-purple-sm">
  <nav class="container mx-auto px-4 sm:px-6 py-3 md:py-4">
    <div class="flex items-center justify-between">
      <a href={base} class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent hover:scale-110 transition-transform">
        JA
      </a>

      <div class="hidden md:flex items-center space-x-8">
        <a
          href={base}
          class={`text-muted-foreground hover:text-primary transition-smooth relative ${currentPath === base || currentPath === base + '/' ? 'text-primary font-semibold' : ''}`}
        >
          Home
          {currentPath === base || currentPath === base + '/' ? <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full"></span> : null}
        </a>
        <a
          href={`${base}/about`}
          class={`text-muted-foreground hover:text-primary transition-smooth relative ${currentPath === `${base}/about` || currentPath === `${base}/about/` ? 'text-primary font-semibold' : ''}`}
        >
          About
          {currentPath === `${base}/about` || currentPath === `${base}/about/` ? <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full"></span> : null}
        </a>
        <a
          href={`${base}/projects`}
          class={`text-muted-foreground hover:text-primary transition-smooth relative ${currentPath === `${base}/projects` || currentPath === `${base}/projects/` ? 'text-primary font-semibold' : ''}`}
        >
          Projects
          {currentPath === `${base}/projects` || currentPath === `${base}/projects/` ? <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full"></span> : null}
        </a>
        <a
          href={`${base}/blog`}
          class={`text-muted-foreground hover:text-primary transition-smooth relative ${currentPath.startsWith(`${base}/blog`) ? 'text-primary font-semibold' : ''}`}
        >
          Blog
          {currentPath.startsWith(`${base}/blog`) ? <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full"></span> : null}
        </a>
        <a
          href={`${base}/contact`}
          class={`text-muted-foreground hover:text-primary transition-smooth relative ${currentPath === `${base}/contact` || currentPath === `${base}/contact/` ? 'text-primary font-semibold' : ''}`}
        >
          Contact
          {currentPath === `${base}/contact` || currentPath === `${base}/contact/` ? <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-primary rounded-full"></span> : null}
        </a>
        <ThemeToggle />
      </div>

      <div class="md:hidden flex items-center space-x-4">
        <ThemeToggle />
        <button id="mobile-menu-button" class="text-muted-foreground hover:text-primary transition-smooth">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <div id="mobile-menu" class="md:hidden overflow-hidden transition-all duration-300 ease-in-out bg-card/95 backdrop-blur-md border-t border-border shadow-lg rounded-b-xl opacity-0 invisible" style="max-height: 0;">
      <div class="flex flex-col space-y-3 p-6">
        <a href={base} class={`text-muted-foreground hover:text-primary transition-smooth ${currentPath === base || currentPath === base + '/' ? 'text-primary font-semibold' : ''}`}>Home</a>
        <a href={`${base}/about`} class={`text-muted-foreground hover:text-primary transition-smooth ${currentPath === `${base}/about` || currentPath === `${base}/about/` ? 'text-primary font-semibold' : ''}`}>About</a>
        <a href={`${base}/projects`} class={`text-muted-foreground hover:text-primary transition-smooth ${currentPath === `${base}/projects` || currentPath === `${base}/projects/` ? 'text-primary font-semibold' : ''}`}>Projects</a>
        <a href={`${base}/blog`} class={`text-muted-foreground hover:text-primary transition-smooth ${currentPath.startsWith(`${base}/blog`) ? 'text-primary font-semibold' : ''}`}>Blog</a>
        <a href={`${base}/contact`} class={`text-muted-foreground hover:text-primary transition-smooth ${currentPath === `${base}/contact` || currentPath === `${base}/contact/` ? 'text-primary font-semibold' : ''}`}>Contact</a>
      </div>
    </div>
  </nav>
</header>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu') as HTMLElement;

  mobileMenuButton?.addEventListener('click', () => {
    if (mobileMenu) {
      const isOpen = mobileMenu.style.maxHeight !== '0px';
      if (isOpen) {
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.classList.add('opacity-0', 'invisible');
        mobileMenu.classList.remove('opacity-100', 'visible');
      } else {
        mobileMenu.style.maxHeight = '400px';
        mobileMenu.classList.remove('opacity-0', 'invisible');
        mobileMenu.classList.add('opacity-100', 'visible');
      }
    }
  });

  document.querySelectorAll('#mobile-menu a').forEach(link => {
    link.addEventListener('click', () => {
      if (mobileMenu) {
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.classList.add('opacity-0', 'invisible');
        mobileMenu.classList.remove('opacity-100', 'visible');
      }
    });
  });
</script>